<!doctype html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>ùêÄùêíùêàùêÄùêó ùêèùêëùêé - Wealth Creation</title>
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome 6 -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <!-- Ethers.js v5 -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

  <style>
    :root {
      --bg: #0a0e1a;
      --card: rgba(20, 30, 50, 0.8);
      --glass: rgba(255,255,255,0.05);
      --accent: #00d4ff;
      --success: #00ff88;
      --warning: #ffaa00;
      --error: #ff4757;
      --muted: #a0b0c0;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    html, body { height:100%; font-family:'Inter',system-ui,sans-serif; }
    body {
      background: linear-gradient(135deg, #0a0e1a 0%, #1a1f2e 50%, #0a0e1a 100%);
      color: #e8f0ff;
      padding-bottom: 20px;
      overflow-x: hidden;
    }
    .app { max-width: 420px; margin: 0 auto; padding: 16px; }
    
    /* Topbar */
    .topbar {
      display: flex; justify-content: space-between; align-items: center;
      padding: 12px 16px; margin-bottom: 16px; backdrop-filter: blur(20px);
      background: rgba(10,14,26,0.8); border-radius: 20px; border: 1px solid rgba(255,255,255,0.1);
    }
    .brand { display: flex; align-items: center; gap: 12px; }
    .custom-logo {
      width: 120px; height: 48px; object-fit: contain;
      background: transparent;     
      border-radius: 0;            
      box-shadow: none;            
    }
    
    .app-title { font-size: 1.2rem; font-weight: 700; background: linear-gradient(135deg, var(--accent), #00ff88); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .app-sub { font-size: 0.8rem; color: var(--muted); }
    
    /* Status */
    .status {
      padding: 12px; border-radius: 12px; text-align: center; font-size: 0.85rem; font-weight: 500;
      background: var(--glass); border: 1px solid rgba(255,255,255,0.1); margin-bottom: 16px;
    }
    .status.success { background: rgba(0,255,136,0.1); color: var(--success); border-color: var(--success); }
    .status.error { background: rgba(255,71,87,0.1); color: var(--error); border-color: var(--error); }
    
    /* Cards */
    .card-app {
      background: var(--glass); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px;
      padding: 20px; margin-bottom: 16px; backdrop-filter: blur(20px);
      box-shadow: 0 8px 32px rgba(0,0,0,0.3); animation: float 6s ease-in-out infinite;
    }
    @keyframes float { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-4px)} }
    
    /* Stats */
    .stats-row { display: flex; gap: 12px; flex-wrap: wrap; }
    .stat {
      flex: 1; padding: 16px; border-radius: 16px; background: rgba(255,255,255,0.02);
      display: flex; flex-direction: column; gap: 8px; min-width: 120px; border: 1px solid rgba(255,255,255,0.05);
    }
    .stat-label { font-size: 0.75rem; color: var(--muted); text-transform: uppercase; letter-spacing: 0.5px; }
    .stat-value { font-size: 1.1rem; font-weight: 700; display: flex; align-items: center; gap: 6px; }
    .stat-value i { font-size: 1rem; color: var(--accent); }
    
    /* Buttons */
    .btn-modern {
      border-radius: 16px; padding: 14px 20px; font-weight: 600; border: none; transition: all 0.3s;
      min-height: 48px; display: flex; align-items: center; justify-content: center; gap: 8px;
    }
    .btn-primary { background: linear-gradient(135deg, var(--accent), #00ff88); color: #000; }
    .btn-success { background: linear-gradient(135deg, var(--success), #00cc66); color: #000; }
    .btn-warning { background: linear-gradient(135deg, var(--warning), #ff8800); color: #000; }
    .btn-outline { background: transparent; border: 1px solid var(--accent); color: var(--accent); }.btn-modern:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,212,255,0.4); }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none !important; }
    
    /* Forms */
    .form-control {
      background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px;
      color: #fff; height: 48px; padding: 12px 16px; transition: all 0.3s;
    }
    .form-control:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(0,212,255,0.2); outline: none; }
    .form-control::placeholder { color: var(--muted); }
    .input-group .form-control { border-radius: 12px 0 0 12px; }
    .input-group .btn { border-radius: 0 12px 12px 0; }
    
    /* Timer */
    .timer-card {
      background: linear-gradient(135deg, rgba(192,192,192,0.1), rgba(169,169,169,0.1));  
      border: 1px solid #C0C0C0;  
      animation: pulse-timer 2s infinite;
    }
    .timer-display { 
      font-size: 1.5rem; font-weight: 700; color: #C0C0C0;  
    }
    @keyframes pulse-timer { 
      0%,100%{box-shadow:0 0 0 0 rgba(192,192,192,0.4)} 50%{box-shadow:0 0 0 12px rgba(192,192,192,0)}  
    }
    /* Bottom Nav */
    .bottom-nav {
      position: relative; left: 50%; transform: translateX(-50%); bottom: 16px; width: calc(100% - 32px);
      display: flex; gap: 12px; background: var(--glass); padding: 12px; border-radius: 20px;
      border: 1px solid rgba(255,255,255,0.1); backdrop-filter: blur(20px);
    }
    .nav-btn { flex: 1; padding: 14px; border-radius: 16px; background: transparent; border: none; color: var(--muted); }
    .nav-btn.active { background: var(--accent); color: #000; }
    .nav-btn:hover { background: rgba(0,212,255,0.2); color: var(--accent); }
    
    /* Responsive */
    @media (max-width: 360px) { .app { padding: 12px; } .card-app { padding: 16px; } }
    .small-text { font-size: 0.8rem; color: var(--muted); }
    .pulse { animation: pulse 2s infinite; }
    @keyframes pulse { 0%{transform:scale(1)} 50%{transform:scale(1.05)} 100%{transform:scale(1)} }
  </style>
</head>
<body>
  <div class="app">
    <!-- Topbar -->
    <div class="topbar">
      <div class="brand">
        <img src="prologo.png" class="custom-logo" alt="ASIAX PRO" />
      </div>
      <button id="connectBtn" class="btn btn-modern btn-primary pulse">
        <i class="fas fa-wallet"></i> <span id="connectLabel">Connect</span>
      </button>
    </div>

    <!-- Status -->
    <div id="status" class="status">Ready ‚Äî Connect Wallet</div>

    <!-- Dashboard -->
    <div class="card-app">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
          <div class="small-text">Welcome</div>
          <div id="userAddress" style="font-weight:700;font-size:1.1rem">Not Connected</div>
        </div>
        <div class="text-end">
          <div id="totalTeam" class="small-text mb-1">My Team: 0</div>
          <button id="shareBtn" class="btn btn-sm btn-outline">
            <i class="fas fa-share-alt"></i>
          </button>
        </div>
      </div>
      
      <div class="stats-row">
        <div class="stat">
          <div class="stat-label">Total Invest</div>
          <div class="stat-value"><i class="fas fa-coins"></i> <span id="totalInvest">0</span> AX</div>
        </div>
        <div class="stat">
          <div class="stat-label">Wallet Bal</div>
          <div class="stat-value"><i class="fas fa-wallet"></i> <span id="walletBal">0</span> AX</div>
        </div>
      </div>
      
      <div class="stats-row mt-2">
        <div class="stat">
          <div class="stat-label">Total Income</div><div class="stat-value"><i class="fas fa-money-bill-wave"></i> <span id="totalWithdrawn">0</span> AX</div>
        </div>
        <div class="stat">
          <div class="stat-label">Pending ROI</div>
          <div class="stat-value"><i class="fas fa-chart-line"></i> <span id="pendingROI">0</span> AX</div>
        </div>
      </div>
    </div><!-- Income -->
    <div class="card-app">
      <div class="small-text mb-2">Income Breakdown</div>
      <div class="stats-row">
        <div class="stat">
          <div class="stat-label">Sponsor</div>
          <div class="stat-value"><i class="fas fa-users"></i> <span id="sponsorInc">0</span> AX</div>
        </div>
        <div class="stat">
          <div class="stat-label">Generation</div>
          <div class="stat-value"><i class="fas fa-network-wired"></i> <span id="genInc">0</span> AX</div>
        </div>
        <div class="stat">
          <div class="stat-label">Pools</div>
          <div class="stat-value"><i class="fas fa-trophy"></i> <span id="poolRewards">0</span> AX</div>
        </div>
      </div>
      <div class="d-flex gap-2 mt-3">
        <button id="claimIncomeBtn" class="btn btn-modern btn-success flex-fill">Claim Income</button>
        <button id="refreshBtn" class="btn btn-modern btn-outline flex-fill"><i class="fas fa-sync"></i></button>
      </div>
    </div>

    <!-- Silver Pool Timer -->
    <div id="timerCard" class="card-app timer-card" style="display:none;">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <div class="small-text">Silver Pool Entry</div>
          <div class="timer-display" id="timerDisplay">30:00:00</div>
        </div>
        <div><i class="fas fa-medal" style="font-size:2rem;color:var(--warning)"></i></div>
      </div>
      <div class="small-text mt-2">Join within 30 days of first investment</div>
    </div>

    <!-- Invest -->
    <div class="card-app">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <div><div class="small-text">Invest</div><div style="font-weight:700">Join Network</div></div>
        <i class="fas fa-hand-holding-usd" style="font-size:1.5rem;color:var(--accent)"></i>
      </div>
      <div class="mb-3">
        <input id="referrerInput" class="form-control" placeholder="üîó Referrer Address (Required)" />
        <div id="referrerStatus" class="small-text mt-1"></div>
      </div>
      <div class="input-group mb-3">
        <input id="investAmount" type="number" class="form-control" placeholder="Amount (AX)" />
        <button id="maxBtn" class="btn btn-outline">MAX</button>
      </div>
      <button id="investBtn" class="btn btn-modern btn-primary w-100">
        <i class="fas fa-rocket"></i> Invest Now
      </button>
    </div>

    <!-- Actions -->
    <div class="card-app">
      <div class="d-flex gap-2">
        <button id="withdrawBtn" class="btn btn-modern btn-success flex-fill">
          <i class="fas fa-arrow-up"></i><br><small>Withdraw</small>
        </button>
        <button id="claimPoolsBtn" class="btn btn-modern btn-warning flex-fill">
          <i class="fas fa-trophy"></i><br><small>Claim Pools</small>
        </button>
      </div>
    </div>

    <!-- Wallet Withdraw -->
    <div class="card-app">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <div><div class="small-text">Fast Withdraw</div><div style="font-weight:700">To Wallet</div></div>
        <i class="fas fa-lightning-bolt" style="font-size:1.5rem;color:var(--success)"></i>
      </div>
      <div class="input-group">
        <input id="withdrawAmt" type="number" class="form-control" placeholder="Amount (10-1000 AX)" />
        <button id="walletWithdrawBtn" class="btn btn-success">GO</button>
      </div>
    </div>

    <!-- Bottom Nav -->
    <div class="bottom-nav">
      <button class="nav-btn active" id="navHome"><i class="fas fa-arrow-left"></i></button>
      <button class="nav-btn" id="navInvest"><i class="fas fa-bars"></i></button>
      <button class="nav-btn" id="navPools"><i class="fas fa-undo"></i></button>
      <button class="nav-btn" id="navTeam"><i class="fas fa-plus"></i></button>
    </div>
  </div><script>
    // ================= CONFIG =================
    const CONTRACT_ADDRESS = "0xF6d0d72AAf0Bbf5C459E680f1e6E75E3B1ce1f06";
    const TOKEN_ADDRESS = "0xe36b5223d488322fac2ddda937e5ab226e83fbbd";
    
    const ABI = [
      "function invest(address _referrer,uint256 _amount) external",
      "function withdraw() external",
      "function claimPoolRewards() external",
      "function WalletWithdraw(uint256 _amount) external",
      "function getUserIncome(address) view returns(uint256,uint256,uint256,uint256,uint256)",
      "function getUserNetwork(address) view returns(uint256,uint256,bool,bool,bool)",
      "function userBasic(address) view returns(address,uint256,uint256,uint256,uint256,uint256,uint256,uint256,uint256,uint256,uint256)",
      "function userWallet(address) view returns(uint256,uint256,uint256)",
      "function totalUsers() view returns(uint256)",
      "function calculatePendingROI(address) view returns(uint256)"
    ];
    
    const TOKEN_ABI = [
      "function balanceOf(address) view returns(uint256)",
      "function approve(address,uint256) external returns(bool)",
      "function allowance(address,address) view returns(uint256)",
      "function decimals() view returns(uint8)"
    ];

    // ================= STATE =================
    let provider, signer, contract, tokenContract, DECIMALS = 18;
    let autoRefresh, timerInterval;
    const REFRESH_INTERVAL = 20000;
    const SILVER_DEADLINE = 30 * 24 * 60 * 60 * 1000;

    // ================= HELPERS =================
    function shortAddr(addr) { return addr ? `${addr.slice(0,6)}...${addr.slice(-4)}` : '‚Äî'; }
    function formatNum(num) { return (num / 1e18).toFixed(2); }
    function setStatus(text, type = '') {
      const el = document.getElementById('status');
      el.textContent = text;
      el.className = `status ${type}`;
    }
    function disableBtn(id, disabled) { document.getElementById(id).disabled = disabled; }

    // ================= FIXED WALLET CONNECT =================
    async function connectWallet() {
      try {
        setStatus('üîì Requesting MetaMask...', '');
        
        if (typeof window.ethereum === 'undefined') {
          throw new Error('MetaMask not found! Install from metamask.io');
        }
        
        const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
        if (!accounts.length) throw new Error('No accounts found');
        
        provider = new ethers.providers.Web3Provider(window.ethereum);
        signer = provider.getSigner();
        const network = await provider.getNetwork();
        
        if (network.chainId !== 137) {
          setStatus('üîÑ Switching to Polygon...', '');
          try {
            await window.ethereum.request({
              method: 'wallet_switchEthereumChain',
              params: [{ chainId: '0x89' }]
            });
          } catch (switchError) {
            if (switchError.code === 4902) {
              await window.ethereum.request({
                method: 'wallet_addEthereumChain',
                params: [{
                  chainId: '0x89',
                  chainName: 'Polygon Mainnet',
                  rpcUrls: ['https://polygon-rpc.com'],
                  nativeCurrency: { name: 'MATIC', symbol: 'MATIC', decimals: 18 },
                  blockExplorerUrls: ['https://polygonscan.com']
                }]
              });
            }
          }
        }
        
        contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);
        tokenContract = new ethers.Contract(TOKEN_ADDRESS, TOKEN_ABI, signer);
        DECIMALS = await tokenContract.decimals();
        
        const addr = await signer.getAddress();
        document.getElementById('userAddress').textContent = shortAddr(addr);
        document.getElementById('connectLabel').textContent = 'Connected';document.getElementById('connectBtn').classList.remove('pulse');
        
        loadData();
        startAutoRefresh();
        setupEvents();
        
        setStatus('‚úÖ Connected to Polygon!', 'success');
        
      } catch (err) {
        console.error('Connect error:', err);
        setStatus(`‚ùå ${err.message}`, 'error');
      }
    } 
   
    // ================= DATA =================
    async function loadData() {
      try {
        const addr = await signer.getAddress();
        const [income, network, basic, wallet] = await Promise.all([
          contract.getUserIncome(addr),
          contract.getUserNetwork(addr),
          contract.userBasic(addr),
          contract.userWallet(addr)
        ]);
        
        document.getElementById('totalInvest').textContent = formatNum(basic[1]);
        document.getElementById('walletBal').textContent = formatNum(wallet[0]);
        document.getElementById('totalWithdrawn').textContent = formatNum(basic[4]);
        document.getElementById('pendingROI').textContent = formatNum(income[0]);
        document.getElementById('sponsorInc').textContent = formatNum(income[1]);
        document.getElementById('genInc').textContent = formatNum(income[2]);
        document.getElementById('poolRewards').textContent = formatNum(income[3]);
        document.getElementById('totalTeam').textContent = `Team: ${network[1]}`;
        
        // ‚úÖ FIXED SILVER TIMER
        if (basic[2] > 0 && !network[2]) {
          const investTime = Number(basic[2]) * 1000;
          const timeElapsed = Date.now() - investTime;
          const timeLeftSeconds = Math.floor((SILVER_DEADLINE - timeElapsed) / 1000);
          if (timeLeftSeconds > 0) showTimer(timeLeftSeconds);
        }
        
        setStatus('‚úÖ Data loaded', 'success');
      } catch (err) {
        console.error('Load error:', err);
        setStatus('Data load failed', 'error');
      }
    }

    // ‚úÖ FIXED CLEAN TIMER FUNCTION
    function showTimer(seconds) {
      const card = document.getElementById('timerCard');
      const display = document.getElementById('timerDisplay');
      card.style.display = 'block';
      
      function updateTimer() {
        if (seconds <= 0) { 
          card.style.display = 'none'; 
          clearInterval(timerInterval); 
          return;
        }
        const days = Math.floor(seconds / 86400);
        const hours = Math.floor((seconds % 86400) / 3600);
        const mins = Math.floor((seconds % 3600) / 60);
        const secs = seconds % 60;
        display.textContent = days + "d " + hours.toString().padStart(2,'0') + ":" + mins.toString().padStart(2,'0') + ":" + secs.toString().padStart(2,'0');
        seconds--;
      }
      timerInterval = setInterval(updateTimer, 1000);
      updateTimer();
    }

    // ================= AUTO GAS APPROVE =================
    async function approveIfNeeded(amountBN) {
      try {
        const user = await signer.getAddress();
        const allowance = await tokenContract.allowance(user, CONTRACT_ADDRESS);
        if (allowance.gte(amountBN)) return null;
        
        setStatus('Approving tokens...', '');
        const approveTxRequest = {
          to: TOKEN_ADDRESS,
          data: tokenContract.interface.encodeFunctionData('approve', [CONTRACT_ADDRESS, amountBN])
        };
        const estimatedGas = await provider.estimateGas(approveTxRequest);
        const gasLimit = estimatedGas.mul(120).div(100);
        
        const tx = await tokenContract.approve(CONTRACT_ADDRESS, amountBN, { 
          gasLimit: gasLimit,
          maxFeePerGas: (await provider.getFeeData()).maxFeePerGas,
          maxPriorityFeePerGas: (await provider.getFeeData()).maxPriorityFeePerGas
        });
        await tx.wait();
        setStatus('‚úÖ Approved!', '');
        return tx;
      } catch (err) {
        throw new Error('Approval failed: ' + (err.reason || err.message));
      }
    }// ================= REFERRAL VALIDATION =================
    async function validateReferrer(refAddr) {
      if (!ethers.utils.isAddress(refAddr)) throw new Error('Invalid address');
      const basic = await contract.userBasic(refAddr);
      if (basic[2].eq(0)) throw new Error('Referrer not registered');
      return true;
    }

    // ================= AUTO GAS INVEST =================
    async function invest() {
      const referrer = document.getElementById('referrerInput').value.trim();
      const amount = parseFloat(document.getElementById('investAmount').value);
      
      if (!referrer) return alert('Referrer required');
      if (amount < 10) return alert('Min 10 AX');
      if (amount % 10 !== 0) return alert('Multiple of 10');
      disableBtn('investBtn', true);
      setStatus('Validating referrer...', '');
      
      try {
        await validateReferrer(referrer);
        const addr = await signer.getAddress();
        const bal = await tokenContract.balanceOf(addr);
        const amountBN = ethers.utils.parseUnits(amount.toString(), DECIMALS);
        if (bal.lt(amountBN)) throw new Error('Insufficient balance');
        
        const isFirst = (await contract.userBasic(addr))[2].eq(0);
        if (isFirst && amount < 120) throw new Error('First investment: Min 120 AX');
        
        // ‚úÖ AUTO APPROVE
        await approveIfNeeded(amountBN);
        
        // ‚úÖ AUTO GAS ESTIMATE
        setStatus('Estimating gas...', '');
        const investTxRequest = {
          to: CONTRACT_ADDRESS,
          data: contract.interface.encodeFunctionData('invest', [referrer, amountBN])
        };
        const estimatedGas = await provider.estimateGas(investTxRequest);
        const gasLimit = estimatedGas.mul(120).div(100);
        const feeData = await provider.getFeeData();
        
        setStatus('Investing...', '');
        const tx = await contract.invest(referrer, amountBN, {
          gasLimit: gasLimit,
          maxFeePerGas: feeData.maxFeePerGas,
          maxPriorityFeePerGas: feeData.maxPriorityFeePerGas
        });
        
        setStatus(`Tx: ${tx.hash.slice(-6)}`, 'success');
        await tx.wait();
        
        setStatus('‚úÖ Investment successful! üéâ', 'success');
        loadData();
        document.getElementById('investAmount').value = '';
        
      } catch (err) {
        setStatus(err.message, 'error');
      }
      disableBtn('investBtn', false);
    }

    async function withdraw() {
      disableBtn('withdrawBtn', true);
      try {
        setStatus('Withdrawing...', '');
        const estimatedGas = await contract.estimateGas.withdraw();
        const gasLimit = estimatedGas.mul(120).div(100);
        const feeData = await provider.getFeeData();
        const tx = await contract.withdraw({ 
          gasLimit: gasLimit,
          maxFeePerGas: feeData.maxFeePerGas,
          maxPriorityFeePerGas: feeData.maxPriorityFeePerGas
        });
        await tx.wait();
        setStatus('‚úÖ Withdrawn successfully!', 'success');
        loadData();
      } catch (err) {
        setStatus(err.reason || err.message, 'error');
      }
      disableBtn('withdrawBtn', false);
    }

    async function claimPools() {
      disableBtn('claimPoolsBtn', true);
      try {
        setStatus('Claiming pools...', '');
        const estimatedGas = await contract.estimateGas.claimPoolRewards();
        const gasLimit = estimatedGas.mul(120).div(100);
        const feeData = await provider.getFeeData();
        const tx = await contract.claimPoolRewards({ 
          gasLimit: gasLimit,
          maxFeePerGas: feeData.maxFeePerGas,
          maxPriorityFeePerGas: feeData.maxPriorityFeePerGas
        });
        await tx.wait();
        setStatus('‚úÖ Pools claimed!', 'success');
        loadData();
      } catch (err) {
        setStatus(err.reason || err.message, 'error');
      }
      disableBtn('claimPoolsBtn', false);
    }async function walletWithdraw() {
      const amount = parseFloat(document.getElementById('withdrawAmt').value);
      if (amount < 10 || amount > 1000) return alert('10-1000 AX only');
      
      disableBtn('walletWithdrawBtn', true);
      try {
        setStatus('Fast withdraw...', '');
        const amountBN = ethers.utils.parseUnits(amount.toString(), DECIMALS);
        const estimatedGas = await contract.estimateGas.WalletWithdraw(amountBN);
        const gasLimit = estimatedGas.mul(120).div(100);
        const feeData = await provider.getFeeData();
        const tx = await contract.WalletWithdraw(amountBN, {
          gasLimit: gasLimit,
          maxFeePerGas: feeData.maxFeePerGas,
          maxPriorityFeePerGas: feeData.maxPriorityFeePerGas
        });
        await tx.wait();
        setStatus('‚úÖ Withdrawn to wallet!', 'success');
        loadData();
      } catch (err) {
        setStatus(err.reason || err.message, 'error');
      }
      disableBtn('walletWithdrawBtn', false);
    }

    async function claimIncome() { await withdraw(); }

    async function setMax() {
      const addr = await signer.getAddress();
      const bal = await tokenContract.balanceOf(addr);
      document.getElementById('investAmount').value = formatNum(bal);
    }

    function startAutoRefresh() {
      if (autoRefresh) clearInterval(autoRefresh);
      autoRefresh = setInterval(loadData, REFRESH_INTERVAL);
    }

    // ================= EVENTS =================
    function setupEvents() {
      const urlParams = new URLSearchParams(window.location.search);
      const ref = urlParams.get('ref');
      if (ref) document.getElementById('referrerInput').value = ref;

      document.getElementById('referrerInput').addEventListener('input', async (e) => {
        const status = document.getElementById('referrerStatus');
        if (!e.target.value) {
          status.textContent = 'Referrer required';
          status.style.color = 'var(--error)';
          return;
        }
        try {
          await validateReferrer(e.target.value);
          status.textContent = '‚úì Valid referrer';
          status.style.color = 'var(--success)';
        } catch {
          status.textContent = '‚úó Invalid referrer';
          status.style.color = 'var(--error)';
        }
      });

      document.getElementById('shareBtn').addEventListener('click', async () => {
        if (!signer) return alert('Connect wallet first');
        try {
          const addr = await signer.getAddress();
          const url = `${window.location.origin}${window.location.pathname}?ref=${addr}`;
          if (navigator.share) {
            await navigator.share({ title: 'Join ASIAX PRO', url });
          } else {
            navigator.clipboard.writeText(url);
            alert('Referral link copied!');
          }
        } catch (err) { alert('Share failed'); }
      });

      document.getElementById('connectBtn').onclick = connectWallet;
      document.getElementById('investBtn').onclick = invest;
      document.getElementById('withdrawBtn').onclick = withdraw;
      document.getElementById('claimPoolsBtn').onclick = claimPools;
      document.getElementById('walletWithdrawBtn').onclick = walletWithdraw;
      document.getElementById('claimIncomeBtn').onclick = claimIncome;
      document.getElementById('maxBtn').onclick = setMax;
      document.getElementById('refreshBtn').onclick = loadData;
    }

    // ================= BOTTOM NAVIGATION =================
    function setupBottomNav() {
      document.getElementById('navHome').onclick = () => window.location.href = 'index.html';
      document.getElementById('navInvest').onclick = () => window.location.href = 'axmenu.html';
      document.getElementById('navPools').onclick = () => window.location.href = 'axpro.html';
      document.getElementById('navTeam').onclick = () => window.location.href = 'axpro.html';
    }// ================= INIT =================
    window.addEventListener('load', () => {
      if (window.ethereum) {
        setStatus('‚úÖ MetaMask Ready! Click Connect', '');
        document.getElementById('connectBtn').classList.add('pulse');
      } else {
        setStatus('‚ùå Install MetaMask', 'error');
      }
      setupEvents();
      setupBottomNav();
    });

    if (window.ethereum) {
      window.ethereum.on('accountsChanged', () => location.reload());
      window.ethereum.on('chainChanged', () => location.reload());
    }
</script>
</body>
</html>
